{% extends "base_minimal.html" %}

{% block title %}{{ channel.name }} - Harvest{% endblock %}

{% block head %}
<style>
    .channel-container {
        max-width: 800px;
        margin: 0 auto;
    }

    .channel-header {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 2rem;
        margin-bottom: 2rem;
        text-align: center;
    }

    .channel-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: #4ecdc4;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        font-weight: 600;
        margin: 0 auto 1rem;
    }

    .channel-name {
        font-size: 2rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .channel-description {
        color: var(--text-dim);
        margin-bottom: 1.5rem;
    }

    .channel-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
    }

    .post-form {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 2rem;
    }

    .post-form textarea {
        width: 100%;
        min-height: 100px;
        margin-bottom: 1rem;
    }

    .posts-container {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .post {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 1.5rem;
    }

    .post-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .post-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--accent);
        color: var(--bg);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        flex-shrink: 0;
    }

    .post-author {
        font-weight: 600;
    }

    .post-time {
        color: var(--text-dim);
        font-size: 0.9rem;
    }

    .post-content {
        margin-bottom: 1rem;
        line-height: 1.6;
    }

    .post-actions {
        display: flex;
        gap: 1rem;
        align-items: center;
    }

    .comments {
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid var(--border);
    }

    .comment {
        padding: 1rem;
        background: var(--bg);
        border-radius: 6px;
        margin-bottom: 1rem;
    }

    .comment-header {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
    }

    .comment-author {
        font-weight: 500;
        font-size: 0.9rem;
    }

    .comment-time {
        color: var(--text-dim);
        font-size: 0.8rem;
    }

    .comment-content {
        font-size: 0.9rem;
        line-height: 1.4;
    }

    .comment-form {
        margin-top: 1rem;
    }

    .comment-form textarea {
        width: 100%;
        min-height: 60px;
        margin-bottom: 0.5rem;
    }

    @media (max-width: 768px) {
        .channel-header {
            padding: 1.5rem;
        }

        .channel-name {
            font-size: 1.5rem;
        }

        .channel-actions {
            flex-direction: column;
        }

        .post {
            padding: 1rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="channel-container">
    <div class="channel-header">
        <div class="channel-avatar">
            {% if channel.avatar %}
                <img src="{{ url_for('static', filename=channel.avatar) }}" alt="–ê–≤–∞—Ç–∞—Ä –∫–∞–Ω–∞–ª–∞" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">
            {% else %}
                {{ channel.name[0].upper() if channel.name else 'C' }}
            {% endif %}
        </div>
        <div class="channel-name">{{ channel.name }}</div>
        {% if channel.description %}
        <div class="channel-description">{{ channel.description }}</div>
        {% endif %}
        <div class="channel-actions">
            {% if channel.creator_id == current_user.id %}
            <a href="{{ url_for('channel_settings', channel_id=channel.id) }}" class="btn">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
            {% endif %}
            {% if is_subscribed %}
                <form method="POST" action="{{ url_for('unsubscribe_channel', channel_id=channel.id) }}" style="display: inline;">
                    <button type="submit" class="btn">–û—Ç–ø–∏—Å–∞—Ç—å—Å—è</button>
                </form>
            {% else %}
                <form method="POST" action="{{ url_for('subscribe_channel', channel_id=channel.id) }}" style="display: inline;">
                    <button type="submit" class="btn btn-primary">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è</button>
                </form>
            {% endif %}
            <a href="{{ url_for('index') }}" class="btn">‚Üê –ù–∞–∑–∞–¥</a>
        </div>
    </div>

    {% if channel.creator_id == current_user.id %}
    <div class="post-form">
        <form method="POST" action="{{ url_for('create_channel_post', channel_id=channel.id) }}">
            <textarea name="content" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –ø–æ—Å—Ç..." required></textarea>
            <button type="submit" class="btn btn-primary">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
        </form>
    </div>
    {% endif %}

    <div class="posts-container">
        {% for post in posts %}
        <div class="post">
            <div class="post-header">
                <div class="post-avatar">
                    {{ post.author.nickname_enc[0].upper() }}
                </div>
                <div>
                    <div class="post-author">{{ post.author.nickname_enc }}</div>
                    <div class="post-time">{{ post.timestamp.strftime('%d.%m.%Y %H:%M') }}</div>
                </div>
            </div>
            <div class="post-content">{{ post.content }}</div>
            <div class="post-actions">
                {% if post.author_id == current_user.id or channel.creator_id == current_user.id %}
                <form method="POST" action="{{ url_for('delete_channel_post', post_id=post.id) }}" style="display: inline;">
                    <button type="submit" class="btn btn-danger" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç?')">–£–¥–∞–ª–∏—Ç—å</button>
                </form>
                {% endif %}
            </div>

            {% if post.comments %}
            <div class="comments">
                {% for comment in post.comments %}
                <div class="comment">
                    <div class="comment-header">
                        <span class="comment-author">{{ comment.author.nickname_enc }}</span>
                        <span class="comment-time">{{ comment.timestamp.strftime('%d.%m.%Y %H:%M') }}</span>
                    </div>
                    <div class="comment-content">{{ comment.content }}</div>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <div class="comment-form">
                <form method="POST" action="{{ url_for('add_channel_comment', post_id=post.id) }}">
                    <textarea name="content" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." required></textarea>
                    <button type="submit" class="btn btn-primary">–ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                </form>
            </div>
        </div>
        {% else %}
        <div class="post">
            <div style="text-align: center; color: var(--text-dim); padding: 2rem;">
                <div style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;">üì¢</div>
                <p>–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤ –≤ —ç—Ç–æ–º –∫–∞–Ω–∞–ª–µ</p>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}