# Решение проблемы с базой данных на Render

## Проблема
Ваше приложение использует SQLite базу данных, которая хранится локально в файловой системе. На Render при каждом деплое создается новый контейнер, и все локальные файлы (включая базу данных) теряются.

## Решение: Переход на PostgreSQL

### 1. Обновленная конфигурация Render

Файл `render.yaml` уже обновлен и теперь включает:
- PostgreSQL базу данных
- Переменную окружения `DATABASE_URL`
- Автоматическое подключение к базе данных

### 2. Обновленные зависимости

В `requirements.txt` добавлен `psycopg2-binary` для работы с PostgreSQL.

### 3. Обновленная конфигурация приложения

В `app.py` изменена логика подключения к базе данных:
- На Render используется PostgreSQL
- Локально продолжает работать SQLite

## Пошаговая инструкция

### Шаг 1: Деплой на Render
1. Закоммитьте все изменения в Git
2. Запушьте изменения на GitHub
3. Render автоматически создаст PostgreSQL базу данных и обновит приложение

### Шаг 2: Миграция данных (опционально)
Если у вас есть важные данные в локальной SQLite базе:

1. **Локально** запустите скрипт миграции:
```bash
python migrate_to_postgresql.py
```

2. **Или** вручную скопируйте данные через админ-панель

### Шаг 3: Проверка
После деплоя:
1. Проверьте, что сайт работает
2. Создайте тестового пользователя
3. Убедитесь, что данные сохраняются между деплоями

## Альтернативные решения

### Решение 2: Использование Render Disk (для SQLite)
Если вы хотите сохранить SQLite:

1. В `render.yaml` добавьте:
```yaml
services:
  - type: web
    name: harvestano
    env: python
    plan: free
    buildCommand: pip install -r requirements.txt
    startCommand: gunicorn --worker-class eventlet -w 1 app:app --bind 0.0.0.0:$PORT
    envVars:
      - key: PYTHON_VERSION
        value: 3.10.12
      - key: PORT
        value: 10000
    disk:
      name: data
      mountPath: /opt/render/project/src/instance
      sizeGB: 1
```

2. Измените путь к базе данных в `app.py`:
```python
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:////opt/render/project/src/instance/harvest.db'
```

### Решение 3: Внешняя база данных
Используйте внешний сервис базы данных:
- Supabase (бесплатный PostgreSQL)
- Railway (PostgreSQL)
- PlanetScale (MySQL)

## Преимущества PostgreSQL

1. **Надежность**: Данные не теряются при деплоях
2. **Масштабируемость**: Лучше для растущих приложений
3. **Производительность**: Быстрее для сложных запросов
4. **Безопасность**: Встроенные механизмы безопасности

## Важные замечания

1. **Бесплатный план Render**: PostgreSQL имеет ограничения по размеру и подключениям
2. **Резервное копирование**: Настройте автоматические бэкапы
3. **Мониторинг**: Следите за использованием ресурсов базы данных

## Устранение неполадок

### Ошибка подключения к PostgreSQL
- Проверьте переменную окружения `DATABASE_URL`
- Убедитесь, что база данных создана на Render
- Проверьте логи приложения

### Ошибки миграции
- Убедитесь, что локальная SQLite база существует
- Проверьте права доступа к файлам
- Запустите миграцию с правами администратора

### Проблемы с производительностью
- Оптимизируйте запросы к базе данных
- Добавьте индексы для часто используемых полей
- Рассмотрите переход на платный план Render

## Контакты для поддержки

Если возникнут проблемы:
1. Проверьте логи в панели управления Render
2. Обратитесь в поддержку Render
3. Создайте issue в репозитории проекта 